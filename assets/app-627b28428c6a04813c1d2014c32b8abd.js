(function($){var isWebkit=!!~navigator.userAgent.indexOf(" AppleWebKit/");$.fn.console=function(config){var keyCodes={37:moveBackward,39:moveForward,38:previousHistory,40:nextHistory,8:backDelete,46:forwardDelete,35:moveToEnd,36:moveToStart,13:commandTrigger,18:doNothing,9:doComplete};var ctrlCodes={65:moveToStart,69:moveToEnd,68:forwardDelete,78:nextHistory,80:previousHistory,66:moveBackward,70:moveForward,75:deleteUntilEnd};if(config.ctrlCodes){$.extend(ctrlCodes,config.ctrlCodes)}var altCodes={70:moveToNextWord,66:moveToPreviousWord,68:deleteNextWord};var shiftCodes={13:newLine};var cursor='<span class="jquery-console-cursor">&nbsp;</span>';var container=$(this);var inner=$('<div class="jquery-console-inner"></div>');var typer=$('<textarea class="jquery-console-typer"></textarea>');var promptBox;var prompt;var promptLabel=config&&config.promptLabel?config.promptLabel:"> ";var continuedPromptLabel=config&&config.continuedPromptLabel?config.continuedPromptLabel:"> ";var column=0;var promptText="";var restoreText="";var continuedText="";var fadeOnReset=config.fadeOnReset!==undefined?config.fadeOnReset:true;var history=[];var ringn=0;var cancelKeyPress=0;var acceptInput=true;var cancelCommand=false;var extern={};(function(){container.append(inner);inner.append(typer);typer.css({position:"absolute",top:0,left:"-9999px"});if(config.welcomeMessage){message(config.welcomeMessage,"jquery-console-welcome")}newPromptBox();if(config.autofocus){inner.addClass("jquery-console-focus");typer.focus();setTimeout(function(){inner.addClass("jquery-console-focus");typer.focus()},100)}extern.inner=inner;extern.typer=typer;extern.scrollToBottom=scrollToBottom})();extern.reset=function(){var welcome=(typeof config.welcomeMessage!="undefined");var removeElements=function(){inner.find("div").each(function(){if(!welcome){$(this).remove()}else{welcome=false}})};var focusConsole=function(){inner.addClass("jquery-console-focus");typer.focus()};if(fadeOnReset){inner.parent().fadeOut(function(){removeElements();newPromptBox();inner.parent().fadeIn(focusConsole)})}else{removeElements();newPromptBox();focusConsole()}};extern.notice=function(msg,style){var n=$('<div class="notice"></div>').append($("<div></div>").text(msg)).css({visibility:"hidden"});container.append(n);var focused=true;if(style=="fadeout"){setTimeout(function(){n.fadeOut(function(){n.remove()})},4000)}else{if(style=="prompt"){var a=$('<br/><div class="action"><a href="javascript:">OK</a><div class="clear"></div></div>');n.append(a);focused=false;a.click(function(){n.fadeOut(function(){n.remove();inner.css({opacity:1})})})}}var h=n.height();n.css({height:"0px",visibility:"visible"}).animate({height:h+"px"},function(){if(!focused){inner.css({opacity:0.5})}});n.css("cursor","default");return n};function newPromptBox(){column=0;promptText="";ringn=0;enableInput();promptBox=$('<div class="jquery-console-prompt-box"></div>');var label=$('<span class="jquery-console-prompt-label"></span>');var labelText=extern.continuedPrompt?continuedPromptLabel:promptLabel;promptBox.append(label.text(labelText).show());label.html(label.html().replace(" ","&nbsp;"));prompt=$('<span class="jquery-console-prompt"></span>');promptBox.append(prompt);inner.append(promptBox);updatePromptDisplay()}container.click(function(){if(window.getSelection().toString()){return false}inner.addClass("jquery-console-focus");inner.removeClass("jquery-console-nofocus");if(isWebkit){typer.focusWithoutScrolling()}else{typer.css("position","fixed").focus()}scrollToBottom();return false});typer.blur(function(){inner.removeClass("jquery-console-focus");inner.addClass("jquery-console-nofocus")});typer.bind("paste",function(e){typer.val("");setTimeout(function(){typer.consoleInsert(typer.val());typer.val("")},0)});typer.keydown(function(e){cancelKeyPress=0;var keyCode=e.keyCode;if(e.ctrlKey&&keyCode==67){cancelKeyPress=keyCode;cancelExecution();return false}if(acceptInput){if(e.shiftKey&&keyCode in shiftCodes){cancelKeyPress=keyCode;(shiftCodes[keyCode])();return false}else{if(e.altKey&&keyCode in altCodes){cancelKeyPress=keyCode;(altCodes[keyCode])();return false}else{if(e.ctrlKey&&keyCode in ctrlCodes){cancelKeyPress=keyCode;(ctrlCodes[keyCode])();return false}else{if(keyCode in keyCodes){cancelKeyPress=keyCode;(keyCodes[keyCode])();return false}}}}}});typer.keypress(function(e){var keyCode=e.keyCode||e.which;if(isIgnorableKey(e)){return false}if((e.ctrlKey||e.metaKey)&&String.fromCharCode(keyCode).toLowerCase()=="v"){return true}if(acceptInput&&cancelKeyPress!=keyCode&&keyCode>=32){if(cancelKeyPress){return false}if(typeof config.charInsertTrigger=="undefined"||(typeof config.charInsertTrigger=="function"&&config.charInsertTrigger(keyCode,promptText))){typer.consoleInsert(keyCode)}}if(isWebkit){return false}});function isIgnorableKey(e){return((e.keyCode==keyCodes.tab||e.keyCode==192)&&e.altKey)}function rotateHistory(n){if(history.length==0){return}ringn+=n;if(ringn<0){ringn=history.length}else{if(ringn>history.length){ringn=0}}var prevText=promptText;if(ringn==0){promptText=restoreText}else{promptText=history[ringn-1]}if(config.historyPreserveColumn){if(promptText.length<column+1){column=promptText.length}else{if(column==0){column=promptText.length}}}else{column=promptText.length}updatePromptDisplay()}function previousHistory(){rotateHistory(-1)}function nextHistory(){rotateHistory(1)}function addToHistory(line){history.push(line);restoreText=""}function deleteCharAtPos(){if(column<promptText.length){promptText=promptText.substring(0,column)+promptText.substring(column+1);restoreText=promptText;return true}else{return false}}function backDelete(){if(moveColumn(-1)){deleteCharAtPos();updatePromptDisplay()}}function forwardDelete(){if(deleteCharAtPos()){updatePromptDisplay()}}function deleteUntilEnd(){while(deleteCharAtPos()){updatePromptDisplay()}}function deleteNextWord(){while(column<promptText.length&&!isCharAlphanumeric(promptText[column])){deleteCharAtPos();updatePromptDisplay()}while(column<promptText.length&&isCharAlphanumeric(promptText[column])){deleteCharAtPos();updatePromptDisplay()}}function newLine(){promptText+="\n";moveColumn(1);updatePromptDisplay()}function commandTrigger(){var line=promptText;if(typeof config.commandValidate=="function"){var ret=config.commandValidate(line);if(ret==true||ret==false){if(ret){handleCommand()}}else{commandResult(ret,"jquery-console-message-error")}}else{handleCommand()}}function scrollToBottom(){var version=jQuery.fn.jquery.split(".");var major=parseInt(version[0]);var minor=parseInt(version[1]);if((major==1&&minor>6)||major>1){inner.prop({scrollTop:inner.prop("scrollHeight")})}else{inner.attr({scrollTop:inner.attr("scrollHeight")})}}function cancelExecution(){if(typeof config.cancelHandle=="function"){config.cancelHandle()}}function handleCommand(){if(typeof config.commandHandle=="function"){disableInput();addToHistory(promptText);var text=promptText;if(extern.continuedPrompt){if(continuedText){continuedText+="\n"+promptText}else{continuedText=promptText}}else{continuedText=undefined}if(continuedText){text=continuedText}var ret=config.commandHandle(text,function(msgs){commandResult(msgs)});if(extern.continuedPrompt&&!continuedText){continuedText=promptText}if(typeof ret=="boolean"){if(ret){commandResult()}else{commandResult("Command failed.","jquery-console-message-error")}}else{if(typeof ret=="string"){commandResult(ret,"jquery-console-message-success")}else{if(typeof ret=="object"&&ret.length){commandResult(ret)}else{if(extern.continuedPrompt){commandResult()}}}}}}function disableInput(){acceptInput=false}function enableInput(){acceptInput=true}function commandResult(msg,className){column=-1;updatePromptDisplay();if(typeof msg=="string"){message(msg,className)}else{if($.isArray(msg)){for(var x in msg){var ret=msg[x];message(ret.msg,ret.className)}}else{inner.append(msg)}}newPromptBox()}function message(msg,className){var mesg=$('<div class="jquery-console-message"></div>');if(className){mesg.addClass(className)}mesg.filledText(msg).hide();inner.append(mesg);mesg.show()}typer.consoleInsert=function(data){var text=isNaN(data)?data:String.fromCharCode(data);var before=promptText.substring(0,column);var after=promptText.substring(column);promptText=before+text+after;moveColumn(text.length);restoreText=promptText;updatePromptDisplay()};function moveColumn(n){if(column+n>=0&&column+n<=promptText.length){column+=n;return true}else{return false}}function moveForward(){if(moveColumn(1)){updatePromptDisplay();return true}return false}function moveBackward(){if(moveColumn(-1)){updatePromptDisplay();return true}return false}function moveToStart(){if(moveColumn(-column)){updatePromptDisplay()}}function moveToEnd(){if(moveColumn(promptText.length-column)){updatePromptDisplay()}}function moveToNextWord(){while(column<promptText.length&&!isCharAlphanumeric(promptText[column])&&moveForward()){}while(column<promptText.length&&isCharAlphanumeric(promptText[column])&&moveForward()){}}function moveToPreviousWord(){while(column-1>=0&&!isCharAlphanumeric(promptText[column-1])&&moveBackward()){}while(column-1>=0&&isCharAlphanumeric(promptText[column-1])&&moveBackward()){}}function isCharAlphanumeric(charToTest){if(typeof charToTest=="string"){var code=charToTest.charCodeAt();return(code>="A".charCodeAt()&&code<="Z".charCodeAt())||(code>="a".charCodeAt()&&code<="z".charCodeAt())||(code>="0".charCodeAt()&&code<="9".charCodeAt())}return false}function doComplete(){if(typeof config.completeHandle=="function"){var completions=config.completeHandle(promptText);var len=completions.length;if(len===1){extern.promptText(promptText+completions[0])}else{if(len>1&&config.cols){var prompt=promptText;var max=0;for(var i=0;i<len;i++){max=Math.max(max,completions[i].length)}max+=2;var n=Math.floor(config.cols/max);var buffer="";var col=0;for(i=0;i<len;i++){var completion=completions[i];buffer+=completions[i];for(var j=completion.length;j<max;j++){buffer+=" "}if(++col>=n){buffer+="\n";col=0}}commandResult(buffer,"jquery-console-message-value");extern.promptText(prompt)}}}}function doNothing(){}extern.promptText=function(text){if(typeof text==="string"){promptText=text;column=promptText.length;updatePromptDisplay()}return promptText};function updatePromptDisplay(){var line=promptText;var html="";if(column>0&&line==""){html=cursor}else{if(column==promptText.length){html=htmlEncode(line)+cursor}else{var before=line.substring(0,column);var current=line.substring(column,column+1);if(current){current='<span class="jquery-console-cursor">'+htmlEncode(current)+"</span>"}var after=line.substring(column+1);html=htmlEncode(before)+current+htmlEncode(after)}}prompt.html(html);scrollToBottom()}function htmlEncode(text){return(text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/</g,"&lt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />"))}return extern};$.fn.filledText=function(txt){$(this).text(txt);$(this).html($(this).html().replace(/ /g,"&nbsp;").replace(/\n/g,"<br/>"));return this};$.fn.focusWithoutScrolling=function(){var x=window.scrollX,y=window.scrollY;$(this).focus();window.scrollTo(x,y)}})(jQuery);(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _){return obj}if(!(this instanceof _)){return new _(obj)}this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.6.0";var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null){return obj}if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else{if(obj.length===+obj.length){for(var i=0,length=obj.length;i<length;i++){if(iterator.call(context,obj[i],i,obj)===breaker){return}}}else{var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker){return}}}}return obj};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null){return results}if(nativeMap&&obj.map===nativeMap){return obj.map(iterator,context)}each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))});return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null){obj=[]}if(nativeReduce&&obj.reduce===nativeReduce){if(context){iterator=_.bind(iterator,context)}return initial?obj.reduce(iterator,memo):obj.reduce(iterator)}each(obj,function(value,index,list){if(!initial){memo=value;initial=true}else{memo=iterator.call(context,memo,value,index,list)}});if(!initial){throw new TypeError(reduceError)}return memo};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null){obj=[]}if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context){iterator=_.bind(iterator,context)}return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator)}var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true}else{memo=iterator.call(context,memo,obj[index],index,list)}});if(!initial){throw new TypeError(reduceError)}return memo};_.find=_.detect=function(obj,predicate,context){var result;any(obj,function(value,index,list){if(predicate.call(context,value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,predicate,context){var results=[];if(obj==null){return results}if(nativeFilter&&obj.filter===nativeFilter){return obj.filter(predicate,context)}each(obj,function(value,index,list){if(predicate.call(context,value,index,list)){results.push(value)}});return results};_.reject=function(obj,predicate,context){return _.filter(obj,function(value,index,list){return !predicate.call(context,value,index,list)},context)};_.every=_.all=function(obj,predicate,context){predicate||(predicate=_.identity);var result=true;if(obj==null){return result}if(nativeEvery&&obj.every===nativeEvery){return obj.every(predicate,context)}each(obj,function(value,index,list){if(!(result=result&&predicate.call(context,value,index,list))){return breaker}});return !!result};var any=_.some=_.any=function(obj,predicate,context){predicate||(predicate=_.identity);var result=false;if(obj==null){return result}if(nativeSome&&obj.some===nativeSome){return obj.some(predicate,context)}each(obj,function(value,index,list){if(result||(result=predicate.call(context,value,index,list))){return breaker}});return !!result};_.contains=_.include=function(obj,target){if(obj==null){return false}if(nativeIndexOf&&obj.indexOf===nativeIndexOf){return obj.indexOf(target)!=-1}return any(obj,function(value){return value===target})};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj)}var result=-Infinity,lastComputed=-Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed>lastComputed){result=value;lastComputed=computed}});return result};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj)}var result=Infinity,lastComputed=Infinity;each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;if(computed<lastComputed){result=value;lastComputed=computed}});return result};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value});return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(obj.length!==+obj.length){obj=_.values(obj)}return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};var lookupIterator=function(value){if(value==null){return _.identity}if(_.isFunction(value)){return value}return _.property(value)};_.sortBy=function(obj,iterator,context){iterator=lookupIterator(iterator);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0){return 1}if(a<b||b===void 0){return -1}}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iterator,context){var result={};iterator=lookupIterator(iterator);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)});return result}};_.groupBy=group(function(result,key,value){_.has(result,key)?result[key].push(value):result[key]=[value]});_.indexBy=group(function(result,key,value){result[key]=value});_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1});_.sortedIndex=function(array,obj,iterator,context){iterator=lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=(low+high)>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low};_.toArray=function(obj){if(!obj){return[]}if(_.isArray(obj)){return slice.call(obj)}if(obj.length===+obj.length){return _.map(obj,_.identity)}return _.values(obj)};_.size=function(obj){if(obj==null){return 0}return(obj.length===+obj.length)?obj.length:_.keys(obj).length};_.first=_.head=_.take=function(array,n,guard){if(array==null){return void 0}if((n==null)||guard){return array[0]}if(n<0){return[]}return slice.call(array,0,n)};_.initial=function(array,n,guard){return slice.call(array,0,array.length-((n==null)||guard?1:n))};_.last=function(array,n,guard){if(array==null){return void 0}if((n==null)||guard){return array[array.length-1]}return slice.call(array,Math.max(array.length-n,0))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,(n==null)||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input)}each(input,function(value){if(_.isArray(value)||_.isArguments(value)){shallow?push.apply(output,value):flatten(value,shallow,output)}else{output.push(value)}});return output};_.flatten=function(array,shallow){return flatten(array,shallow,[])};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.partition=function(array,predicate){var pass=[],fail=[];each(array,function(elem){(predicate(elem)?pass:fail).push(elem)});return[pass,fail]};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false}var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?(!index||seen[seen.length-1]!==value):!_.contains(seen,value)){seen.push(value);results.push(array[index])}});return results};_.union=function(){return _.uniq(_.flatten(arguments,true))};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.contains(other,item)})})};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return !_.contains(rest,value)})};_.zip=function(){var length=_.max(_.pluck(arguments,"length").concat(0));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,""+i)}return results};_.object=function(list,values){if(list==null){return{}}var result={};for(var i=0,length=list.length;i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};_.indexOf=function(array,item,isSorted){if(array==null){return -1}var i=0,length=array.length;if(isSorted){if(typeof isSorted=="number"){i=(isSorted<0?Math.max(0,length+isSorted):isSorted)}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1}}if(nativeIndexOf&&array.indexOf===nativeIndexOf){return array.indexOf(item,isSorted)}for(;i<length;i++){if(array[i]===item){return i}}return -1};_.lastIndexOf=function(array,item,from){if(array==null){return -1}var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item)}var i=(hasIndex?from:array.length);while(i--){if(array[i]===item){return i}}return -1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=arguments[2]||1;var length=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(length);while(idx<length){range[idx++]=start;start+=step}return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind){return nativeBind.apply(func,slice.call(arguments,1))}if(!_.isFunction(func)){throw new TypeError}args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound)){return func.apply(context,args.concat(slice.call(arguments)))}ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result){return result}return self}};_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){var position=0;var args=boundArgs.slice();for(var i=0,length=args.length;i<length;i++){if(args[i]===_){args[i]=arguments[position++]}}while(position<arguments.length){args.push(arguments[position++])}return func.apply(this,args)}};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0){throw new Error("bindAll must be passed function names")}each(funcs,function(f){obj[f]=_.bind(obj[f],obj)});return obj};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments))}};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;options||(options={});var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false){previous=now}var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);context=args=null}else{if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout){timeout=setTimeout(later,wait)}if(callNow){result=func.apply(context,args);context=args=null}return result}};_.once=function(func){var ran=false,memo;return function(){if(ran){return memo}ran=true;memo=func.apply(this,arguments);func=null;return memo}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)]}return args[0]}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.keys=function(obj){if(!_.isObject(obj)){return[]}if(nativeKeys){return nativeKeys(obj)}var keys=[];for(var key in obj){if(_.has(obj,key)){keys.push(key)}}return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=new Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=new Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key])){names.push(key)}}return names.sort()};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj){copy[key]=obj[key]}});return copy};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key)){copy[key]=obj[key]}}return copy};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]===void 0){obj[prop]=source[prop]}}}});return obj};_.clone=function(obj){if(!_.isObject(obj)){return obj}return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b){return a!==0||1/a==1/b}if(a==null||b==null){return a===b}if(a instanceof _){a=a._wrapped}if(b instanceof _){b=b._wrapped}var className=toString.call(a);if(className!=toString.call(b)){return false}switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:(a==0?1/a==1/b:a==+b);case"[object Date]":case"[object Boolean]":return +a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object"){return false}var length=aStack.length;while(length--){if(aStack[length]==a){return bStack[length]==b}}var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&(aCtor instanceof aCtor)&&_.isFunction(bCtor)&&(bCtor instanceof bCtor))&&("constructor" in a&&"constructor" in b)){return false}aStack.push(a);bStack.push(b);var size=0,result=true;if(className=="[object Array]"){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack))){break}}}}else{for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack))){break}}}if(result){for(key in b){if(_.has(b,key)&&!(size--)){break}}result=!size}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null){return true}if(_.isArray(obj)||_.isString(obj)){return obj.length===0}for(var key in obj){if(_.has(obj,key)){return false}}return true};_.isElement=function(obj){return !!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=="[object Array]"};_.isObject=function(obj){return obj===Object(obj)};each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return !!(obj&&_.has(obj,"callee"))}}if(typeof(/./)!=="function"){_.isFunction=function(obj){return typeof obj==="function"}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.property=function(key){return function(obj){return obj[key]}};_.matches=function(attrs){return function(obj){if(obj===attrs){return true}for(var key in attrs){if(attrs[key]!==obj[key]){return false}}return true}};_.times=function(n,iterator,context){var accum=Array(Math.max(0,n));for(var i=0;i<n;i++){accum[i]=iterator.call(context,i)}return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return new Date().getTime()};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){if(string==null){return""}return(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}});_.result=function(object,property){if(object==null){return void 0}var value=object[property];return _.isFunction(value)?value.call(object):value};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}if(evaluate){source+="';\n"+evaluate+"\n__p+='"}index=offset+match.length;return match});source+="';\n";if(!settings.variable){source="with(obj||{}){\n"+source+"}\n"}source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}if(data){return render(data,_)}var template=function(data){return render.call(this,data,_)};template.source="function("+(settings.variable||"obj")+"){\n"+source+"}";return template};_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_);each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=="shift"||name=="splice")&&obj.length===0){delete obj[0]}return result.call(this,obj)}});each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.extend(_.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}});if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this);(function(root,factory){if(typeof module==="object"&&module.exports){module.exports=function(_){_=_||require("underscore");return factory(_)}}else{if(typeof define==="function"&&define.amd){define(["underscore"],function(_){return factory(_,root)})}else{root.machina=factory(root._,root)}}}(this,function(_,global,undefined){var slice=[].slice;var NEXT_TRANSITION="transition";var NEXT_HANDLER="handler";var HANDLING="handling";var HANDLED="handled";var NO_HANDLER="nohandler";var TRANSITION="transition";var INVALID_STATE="invalidstate";var DEFERRED="deferred";var NEW_FSM="newfsm";var utils={makeFsmNamespace:(function(){var machinaCount=0;return function(){return"fsm."+machinaCount++}})(),getDefaultOptions:function(){return{initialState:"uninitialized",eventListeners:{"*":[]},states:{},eventQueue:[],namespace:utils.makeFsmNamespace(),targetReplayState:"",state:undefined,priorState:undefined,_priorAction:"",_currentAction:""}}};if(!_.deepExtend){var behavior={"*":function(obj,sourcePropKey,sourcePropVal){obj[sourcePropKey]=sourcePropVal},object:function(obj,sourcePropKey,sourcePropVal){obj[sourcePropKey]=deepExtend({},obj[sourcePropKey]||{},sourcePropVal)},array:function(obj,sourcePropKey,sourcePropVal){obj[sourcePropKey]=[];_.each(sourcePropVal,function(item,idx){behavior[getHandlerName(item)](obj[sourcePropKey],idx,item)},this)}},getActualType=function(val){if(_.isArray(val)){return"array"}if(_.isDate(val)){return"date"}if(_.isRegExp(val)){return"regex"}return typeof val},getHandlerName=function(val){var propType=getActualType(val);return behavior[propType]?propType:"*"},deepExtend=function(obj){_.each(slice.call(arguments,1),function(source){_.each(source,function(sourcePropVal,sourcePropKey){behavior[getHandlerName(sourcePropVal)](obj,sourcePropKey,sourcePropVal)})});return obj};_.mixin({deepExtend:deepExtend})}var Fsm=function(options){_.extend(this,options);_.defaults(this,utils.getDefaultOptions());this.initialize.apply(this,arguments);machina.emit(NEW_FSM,this);if(this.initialState){this.transition(this.initialState)}};_.extend(Fsm.prototype,{initialize:function(){},emit:function(eventName){var args=arguments;if(this.eventListeners["*"]){_.each(this.eventListeners["*"],function(callback){try{callback.apply(this,slice.call(args,0))}catch(exception){if(console&&typeof console.log!=="undefined"){console.log(exception.toString())}}},this)}if(this.eventListeners[eventName]){_.each(this.eventListeners[eventName],function(callback){try{callback.apply(this,slice.call(args,1))}catch(exception){if(console&&typeof console.log!=="undefined"){console.log(exception.toString())}}},this)}},handle:function(inputType){if(!this.inExitHandler){var states=this.states,current=this.state,args=slice.call(arguments,0),handlerName,handler,catchAll,action;this.currentActionArgs=args;if(states[current][inputType]||states[current]["*"]||this["*"]){handlerName=states[current][inputType]?inputType:"*";catchAll=handlerName==="*";if(states[current][handlerName]){handler=states[current][handlerName];action=current+"."+handlerName}else{handler=this["*"];action="*"}if(!this._currentAction){this._currentAction=action}this.emit.call(this,HANDLING,{inputType:inputType,args:args.slice(1)});if(_.isFunction(handler)){handler=handler.apply(this,catchAll?args:args.slice(1))}if(_.isString(handler)){this.transition(handler)}this.emit.call(this,HANDLED,{inputType:inputType,args:args.slice(1)});this._priorAction=this._currentAction;this._currentAction="";this.processQueue(NEXT_HANDLER)}else{this.emit.call(this,NO_HANDLER,{inputType:inputType,args:args.slice(1)})}this.currentActionArgs=undefined}},transition:function(newState){if(!this.inExitHandler&&newState!==this.state){var curState=this.state;if(this.states[newState]){if(this.states[curState]&&this.states[curState]._onExit){this.inExitHandler=true;this.states[curState]._onExit.call(this);this.inExitHandler=false}this.targetReplayState=newState;this.priorState=curState;this.state=newState;this.emit.call(this,TRANSITION,{fromState:this.priorState,action:this._currentAction,toState:newState});if(this.states[newState]._onEnter){this.states[newState]._onEnter.call(this)}if(this.targetReplayState===newState){this.processQueue(NEXT_TRANSITION)}return}this.emit.call(this,INVALID_STATE,{state:this.state,attemptedState:newState})}},processQueue:function(type){var filterFn=type===NEXT_TRANSITION?function(item){return item.type===NEXT_TRANSITION&&((!item.untilState)||(item.untilState===this.state))}:function(item){return item.type===NEXT_HANDLER};var toProcess=_.filter(this.eventQueue,filterFn,this);this.eventQueue=_.difference(this.eventQueue,toProcess);_.each(toProcess,function(item){this.handle.apply(this,item.args)},this)},clearQueue:function(type,name){if(!type){this.eventQueue=[]}else{var filter;if(type===NEXT_TRANSITION){filter=function(evnt){return(evnt.type===NEXT_TRANSITION&&(name?evnt.untilState===name:true))}}else{if(type===NEXT_HANDLER){filter=function(evnt){return evnt.type===NEXT_HANDLER}}}this.eventQueue=_.filter(this.eventQueue,filter)}},deferUntilTransition:function(stateName){if(this.currentActionArgs){var queued={type:NEXT_TRANSITION,untilState:stateName,args:this.currentActionArgs};this.eventQueue.push(queued);this.emit.call(this,DEFERRED,{state:this.state,queuedArgs:queued})}},deferUntilNextHandler:function(){if(this.currentActionArgs){var queued={type:NEXT_HANDLER,args:this.currentActionArgs};this.eventQueue.push(queued);this.emit.call(this,DEFERRED,{state:this.state,queuedArgs:queued})}},on:function(eventName,callback){var self=this;if(!self.eventListeners[eventName]){self.eventListeners[eventName]=[]}self.eventListeners[eventName].push(callback);return{eventName:eventName,callback:callback,off:function(){self.off(eventName,callback)}}},off:function(eventName,callback){if(!eventName){this.eventListeners={}}else{if(this.eventListeners[eventName]){if(callback){this.eventListeners[eventName]=_.without(this.eventListeners[eventName],callback)}else{this.eventListeners[eventName]=[]}}}}});Fsm.prototype.trigger=Fsm.prototype.emit;var ctor=function(){};var inherits=function(parent,protoProps,staticProps){var fsm;if(protoProps&&protoProps.hasOwnProperty("constructor")){fsm=protoProps.constructor}else{fsm=function(){parent.apply(this,arguments)}}_.deepExtend(fsm,parent);ctor.prototype=parent.prototype;fsm.prototype=new ctor();if(protoProps){_.deepExtend(fsm.prototype,protoProps)}if(staticProps){_.deepExtend(fsm,staticProps)}fsm.prototype.constructor=fsm;fsm.__super__=parent.prototype;return fsm};Fsm.extend=function(protoProps,classProps){var fsm=inherits(this,protoProps,classProps);fsm.extend=this.extend;return fsm};var machina={Fsm:Fsm,utils:utils,on:function(eventName,callback){if(!this.eventListeners[eventName]){this.eventListeners[eventName]=[]}this.eventListeners[eventName].push(callback);return callback},off:function(eventName,callback){if(this.eventListeners[eventName]){this.eventListeners[eventName]=_.without(this.eventListeners[eventName],callback)}},trigger:function(eventName){var i=0,len,args=arguments,listeners=this.eventListeners[eventName]||[];if(listeners&&listeners.length){_.each(listeners,function(callback){callback.apply(null,slice.call(args,1))})}},eventListeners:{newFsm:[]}};machina.emit=machina.trigger;return machina}));(function(window){var re={not_string:/[^s]/,number:/[def]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};function sprintf(){var key=arguments[0],cache=sprintf.cache;if(!(cache[key]&&cache.hasOwnProperty(key))){cache[key]=sprintf.parse(key)}return sprintf.format.call(null,cache[key],arguments)}sprintf.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type="",arg,output=[],i,k,match,pad,pad_character,pad_length,is_positive=true,sign="";for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==="string"){output[output.length]=parse_tree[i]}else{if(node_type==="array"){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k])){throw new Error(sprintf("[sprintf] property '%s' does not exist",match[2][k]))}arg=arg[match[2][k]]}}else{if(match[1]){arg=argv[match[1]]}else{arg=argv[cursor++]}}if(get_type(arg)=="function"){arg=arg()}if(re.not_string.test(match[8])&&(get_type(arg)!="number"&&isNaN(arg))){throw new TypeError(sprintf("[sprintf] expecting number but found %s",get_type(arg)))}if(re.number.test(match[8])){is_positive=arg>=0}switch(match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":arg=parseInt(arg,10);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=((arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg);break;case"u":arg=arg>>>0;break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase();break}if(!is_positive||(re.number.test(match[8])&&match[3])){sign=is_positive?"+":"-";arg=arg.toString().replace(re.sign,"")}pad_character=match[4]?match[4]=="0"?"0":match[4].charAt(1):" ";pad_length=match[6]-(sign+arg).length;pad=match[6]?str_repeat(pad_character,pad_length):"";output[output.length]=match[5]?sign+arg+pad:(pad_character==0?sign+pad+arg:pad+sign+arg)}}}return output.join("")};sprintf.cache={};sprintf.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=re.text.exec(_fmt))!==null){parse_tree[parse_tree.length]=match[0]}else{if((match=re.modulo.exec(_fmt))!==null){parse_tree[parse_tree.length]="%"}else{if((match=re.placeholder.exec(_fmt))!==null){if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=re.key.exec(replacement_field))!==null){field_list[field_list.length]=field_match[1];while((replacement_field=replacement_field.substring(field_match[0].length))!==""){if((field_match=re.key_access.exec(replacement_field))!==null){field_list[field_list.length]=field_match[1]}else{if((field_match=re.index_access.exec(replacement_field))!==null){field_list[field_list.length]=field_match[1]}else{throw new SyntaxError("[sprintf] failed to parse named argument key")}}}}else{throw new SyntaxError("[sprintf] failed to parse named argument key")}match[2]=field_list}else{arg_names|=2}if(arg_names===3){throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported")}parse_tree[parse_tree.length]=match}else{throw new SyntaxError("[sprintf] unexpected placeholder")}}}_fmt=_fmt.substring(match[0].length)}return parse_tree};var vsprintf=function(fmt,argv,_argv){_argv=(argv||[]).slice(0);_argv.splice(0,0,fmt);return sprintf.apply(null,_argv)};function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}function str_repeat(input,multiplier){return Array(multiplier+1).join(input)}if(typeof exports!=="undefined"){exports.sprintf=sprintf;exports.vsprintf=vsprintf}else{window.sprintf=sprintf;window.vsprintf=vsprintf;if(typeof define==="function"&&define.amd){define(function(){return{sprintf:sprintf,vsprintf:vsprintf}})}}})(typeof window==="undefined"?this:window);(function(){(function($,_){$(function(){var console1,controller1,gameFsm;gameFsm=new machina.Fsm({initialState:"startGame",WEEDING_EFFECTS:{"0":[0.75,0,0],"1":[1,86,0],"2":[1.05,60,0],"3":[1.15,8,95],"11":[1.15,144,0],"12":[1.15,146,0],"13":[1.2,83,95],"21":[1.15,165,0],"22":[1.15,125,0],"23":[1.2,125,95],"31":[1.2,83,95],"32":[1.2,83,95],"33":[1.25,16,180]},VALID_WEEDING:function(){return _.keys(this.WEEDING_EFFECTS).join(",")},SEEDBED_PREP_HOURS:24,TRACTOR_HOURS:3,CARABAO_HOURS:72,TRACTOR_RATE:45,CARABAO_RATE:25,FMT:"%-31s     %9.2f",FMT2:"    %-31s %9.2f",data:{runCount:1,costs:{irrigation:945,landTax:1015},hours:{transplanting:18*8},snailAttacks:0,fertNContent:function(){return 0.45*this.fertApplRate},seedYield:function(){if(this.seedType==="LOCAL"){return 1920}else{return 2250}},ureaFactor1:function(){if(this.seedType==="LOCAL"){return -0.00026}else{return -0.00015}},ureaFactor2:function(){if(this.seedType==="LOCAL"){return 0.023}else{return 0.032}}},totalCosts:function(key){var _base;if((_base=this.data.costs)[key]==null){_base[key]=0}return this.data.costs[key]*this.data.farmSize},labor:function(key){var _base;if((_base=this.data.hours)[key]==null){_base[key]=0}return(this.data.farmSize*this.data.wages/8)*this.data.hours[key]},states:{startGame:{input:function(line){var response;response=this.getYesNo(line);if(!this.errorFlag){this.data.skipIntro=response;if(response){this.transition("mainIntro")}else{this.transition("intro1")}}}},intro1:{_onEnter:function(){this.message="\n\nWelcome to the real world!  YOU ARE TO PLAY THE ROLE OF A\n   SMALL-TIME RICE FARMER IN THE PHILIPPINES.  YOU HAVE\n   CONTROL OVER MOST OF THE FACTORS WHICH INFLUENCE YOUR\n   OUTPUT.  THE IDEA IS TO RAISE SEVERAL SUCCESSIVE CROPS,\n   ALWAYS TRYING TO INCREASE YOUR RETURNS TO LABOR AND\n   CAPITAL. A FAILURE FOR A SINGLE YEAR MAY MEAN A MAJOR\n   CRISIS FOR YOU AND FOR THE FAMILY.  GOOD LUCK!!!\n\n\n\nYOU ARE A NEW OWNER AS A RESULT OF LAND REFORM.\nYOUR LAND IS IRRIGATED.\nYOUR HEADMAN WOULD LIKE YOU TO RAISE 'IR64' WHICH IS SAID TO\nACHIEVE VERY HIGH YIELDS, BUT YOU ARE FAMILIAR WITH 'LOCAL' RICE\nAND HESITATE TO EXPERIMENT WITH NEW KINDS OF SEEDS.\n"+this.waitText},input:function(line){this.transition("intro2")}},intro2:{_onEnter:function(){this.message="\n\n\n    FIRST, A FEW TERMS YOU SHOULD KNOW:\n      HECTARE (HA.) = 10,000 SQ. METERS (2.47 ACRES)\n      KILOGRAM (KG.) = 2.2 POUNDS\n      PESO = U.S. $0.023 ($1 = 44 PESOS)\n      CAVAN = VOLUME MEASURE - ROUGHLY 50 KG. OF PALAY\n      PALAY = THE TERM FOR THRESHED BUT UNHUSKED RICE\n      IR64 = A HIGH YIELDING RICE VARIETY FIRST RELEASED IN 1985\n      LODGING = PLANT FALLS OVER FROM TOO WEAK STEM.\n"+this.waitText},input:function(line){this.transition("factors1")}},factors1:{_onEnter:function(){this.message="\n\nFactors you can control include (among others) the following 10:\n\n     1. SIZE OF FARM (IN HECTARES).\n  THE MEAN FARM SIZE IN CENTRAL LUZON IS ABOUT 1.8 HA. BUT\n  SOME FARMS ARE A FRACTION OF A HA. WHILE OTHERS ARE AS\n  LARGE AS 50 HECTARES.\n  \n     2. COSTS OF OUTSIDE LABOR (IN PESOS/DAY).\n  LABOR COSTS PER DAY FOR FARM WORK (1998) VARY FROM PESOS\n  105 TO PESOS 125 DEPENDING ON LOCATION AND SEASON. SOME\n  SMALL SNACK FOODS ARE NORMALLY ADDED TO THIS COST.\n  \n     3. TYPE OF RICE (SEED) USED.\n  IR64 HAS GREAT POTENTIAL, BUT MOST FARMERS ARE FAMILIAR\n  WITH LOCAL VARIETIES.\n  "+this.waitText},input:function(line){this.transition("factors2")}},factors2:{_onEnter:function(){this.message="\n     4. COST OF SEED.\n  SEEDS ARE USED AT THE RATE OF 1 CAVAN PER HA. OF FARM.\n  ORDINARY HYV SEED COSTS 570 - 630 PESOS PER CAVAN.\n  GOVERNMENT INSPECTED SEED OF VERY GOOD QUALITY SELLS AT \n  ABOUT 675 PESOS. SOMETIMES A FARMER WITH SURPLUS RICE\n  WILL OFFER A 'DEAL' - SEED FOR much LOWER COST. SOME\n  SHARP BUSINESS TYPES MAY OFFER 'SELECTED' SEED FOR AS\n  MUCH AS 700 - 750 PESOS.\n\n  LET'S ASSUME THAT OUR FARMER USES A VERY EFFICIENT SEED\n  RATE OF ONE CAVAN PER HECTARE!\n"+this.waitText},input:function(line){this.transition("factors3")}},factors3:{_onEnter:function(){this.message="\n     5. USE OF SYSTEMIC PESTICIDE, I.P.M., OR NOTHING.\n  I.P.M. (OR INTEGRATED PEST MANAGEMENT) INVOLVES CAREFUL\n  CULTIVATION TECHNIQUES, THE ENCOURAGEMENT OF RICE PEST PREDATORS,\n  AND CONSTANT MONITORING OF PEST INFESTATIONS. IF THESE EXCEED\n  ACCEPTABLE LEVELS THEN A LIMITED SPRAY PROGRAM IS UNDERTAKEN.\n    SYSTEMIC PESTICIDES ARE DESIGNED TO RID YOUR FIELDS OF\n  INSECTS. THIS OFTEN INCLUDES PEST PREDATORS AS WELL AS STEM-\n  BORERS, ARMY WORMS AND LEAF HOPPERS.\n    SYSTEMICS ARE APPLIED AT TRANSPLANTING. (THIS IS WELL BEFORE\n  ANY INSECT ATTACK WILL BE OBSERVED). SYSTEMICS ARE COSTLY\n  BUT EFFECTIVE IN CUTTING LOSS FROM MANY INSECTS. MOST\n  FARMERS GAMBLE ON A LIGHT ATTACK AND DON'T USE SYSTEMICS.\n"+this.waitText},input:function(line){this.transition("factors4")}},factors4:{_onEnter:function(){this.message="\n     6. COST AND AMOUNT OF NITROGEN FERTILIZER.\n  UREA IS THE CHEAPEST FORM OF NITROGEN. BY WEIGHT IT HAS\n  45 PERCENT N. A BAG OF UREA WEIGHS 50 KG.; AND COSTS BETWEEN\n  PESOS 350 - 370 (1998).\n\n     7. METHOD OF CROPLAND PREPARATION.\n  USE OF THE CARABAO IS TRADITIONAL, BUT MANY FARMERS TODAY\n  ARE HAVING THEIR FIELDS CUSTOM PLOWED BY SMALL TRACTOR.\n  ADVANTAGES OF THIS ARE SPEED AND BETTER WEED CONTROL.\n\n     8. METHOD OF WEEDING AND HERBICIDE APPLICATIONS.\n  WEEDING TOO HAS TRADITIONALLY BEEN DONE BY HAND.\n  THE USE OF HERBICIDES IS A RECENT INNOVATION.\n"+this.waitText},input:function(line){this.transition("factors5")}},factors5:{_onEnter:function(){this.message="\n     9. METHOD OF THRESHING.\n  WITH INCREASED YIELDS MANY FARMERS ARE HIRING CUSTOM MACHINE\n  THRESHING RATHER THAN STICKING WITH THE OLD HAND METHOD.\n\n     10. MARKET VALUE OF ROUGH RICE.\n  VARIES WITH VARIETY, QUALITY AND SEASON. AVERAGES (1994)\n  ABOUT 312 PESOS PER CAVAN (6.25 PESOS PER KG.)\n  MILLING RATE IS ROUGHLY 64% (50 KG. OF PALAY YIELDS\n  32 KG. OF RICE).  RETAIL PRICE OF RICE AVERAGED\n  (1994) 10.75 PESOS PER KG.\n"+this.waitText},input:function(line){this.transition("mainIntro")}},mainIntro:{_onEnter:function(){this.message="\n\n  FOR YOUR FIRST CROP YOU MUST MAKE ALL THE DECISIONS BASED\n  ON THE INFORMATION GIVEN IN THE INITIAL INTRODUCTION\n  AND INSTRUCTIONS.\n\n  This is the WET season and you have IRRIGATION.\n"+this.waitText},input:function(line){this.transition("setFarmSize")}},setFarmSize:{_onEnter:function(){if(!this.errorFlag){this.message="\nWhat is the size of your farm (IN HECTARES)?\n"}},input:function(line){this.data.farmSize=this.getNumber(this.data.farmSize,line);if(!this.errorFlag){if(this.data.farmSize>=5){this.message="THAT'S PRETTY LARGE FOR A PEASANT IN LUZON."}else{this.message=""}if(!(this.data.runCount>1)){this.transition("setWages")}else{this.transition("startProcessing")}}}},setWages:{_onEnter:function(){this.message+="\nWHAT IS THE COST OF OUTSIDE LABOR IN PESOS PER DAY?\n"},input:function(line){this.data.wages=this.getNumber(this.data.wages,line);if(!this.errorFlag){if(this.data.wages<=100){this.message="Those are terrible wages - you cheapskate!!!\n"}else{if(this.data.wages>139){this.message="Very high wages - I doubt you can afford them\n"}else{this.message=""}}if(!(this.data.runCount>1)){this.transition("setSeedType")}else{this.transition("startProcessing")}}}},setSeedType:{_onEnter:function(){this.message+="\nIS 'LOCAL' OR 'IR64' RICE TO BE PLANTED?\n"},input:function(line){this.data.seedType=this.getResponse("LOCAL,IR64",this.data.seedType,line);if(!this.errorFlag){if(!(this.data.runCount>1)){this.transition("setSeedCost")}else{this.transition("startProcessing")}}}},setSeedCost:{_onEnter:function(){this.message="\nWHAT IS THE COST OF SEED IN PESOS/HA?\n"},input:function(line){this.data.costs.seeds=this.getNumber(this.data.costs.seeds,line);if(!this.errorFlag){if(this.data.costs.seeds>680){this.message="expensive seed - it may not be good - too old\n";this.data.seedDefectFactor=0.9}else{if(this.data.costs.seeds<=560){this.message="cheap seed - why waste time with it - poor germination\n";this.data.seedDefectFactor=0.9}else{this.message="";this.data.seedDefectFactor=1}}if(!(this.data.runCount>1)){this.transition("setPesticide")}else{this.transition("startProcessing")}}}},setPesticide:{_onEnter:function(){this.message+="\nDO YOU WISH TO APPLY SYSTEMIC PESTICIDE? 'YES' OR 'NO'\n"},input:function(line){var response;response=this.getYesNo(line);if(!this.errorFlag){if(response){this.data.pesticideYieldFactor=1.15;this.data.costs.earlyPestControl=390;this.data.hours.earlyPestControl=1.5*8;if(!(this.data.runCount>1)){this.transition("setFertilizer")}else{this.transition("startProcessing")}}else{this.data.costs.earlyPestControl=0;this.data.hours.earlyPestControl=0;this.transition("setIPM")}}}},setIPM:{_onEnter:function(){this.message="\nDO YOU WISH TO USE I.P.M.? 'YES' OR 'NO'\n"},input:function(line){var response;response=this.getYesNo(line);if(!this.errorFlag){if(response){this.data.pesticideYieldFactor=1.15;this.data.costs.early_pest_control=390;this.data.hours.early_pest_control=1.5*8}else{this.data.pesticideYieldFactor=1}if(!(this.data.runCount>1)){this.transition("setFertilizer")}else{this.transition("startProcessing")}}}},setFertilizer:{_onEnter:function(){this.message="\nFOR NITROGEN FERTILIZER (UREA):\n     1. WHAT IS YOUR RATE OF APPLICATION? (KG./HA.)\n"},input:function(line){this.data.fertApplRate=this.getNumber(this.data.fertApplRate,line);if(!this.errorFlag){if(this.data.fertApplRate<=0){this.data.fertApplRate=0;this.transition("setLandPrep")}else{if(this.data.fertApplRate>400){this.message="\n"+this.data.fertApplRate+" KG. OF UREA CONTAINS "+(this.data.fertNContent())+" KG. OF NITROGEN.\nYOUR CROP CAN NOT USE THAT MUCH.  YOU MAY CAUSE SOME\nDAMAGE TO THE ECOSYSTEMS IN NEARBY STREAMS.  AT THE\nVERY LEAST, YOU HAVE WASTED MANY PESOS.\n\n"}else{this.message=""}this.transition("setFertilizer2")}}}},setFertilizer2:{_onEnter:function(){this.message+="     2. WHAT IS THE COST OF UREA (PESOS/KG.)\n"},input:function(line){this.data.fertCost=this.getNumber(this.data.fertCost,line);if(!this.errorFlag){if(this.data.fertCost<=6.8){this.message="You can not buy it so CHEAPLY - PLEASE REPEAT"}else{if(this.data.fertCost>7.4){this.message="THAT IS EXPENSIVE FERTILIZER - PLEASE REPEAT"}else{this.data.costs.fertilizer=this.data.fertApplRate*this.data.fertCost;this.data.hours.fertilizer=(1.5+this.data.fertApplRate/50)*8;if(!(this.data.runCount>1)){this.transition("setLandPrep")}else{this.transition("startProcessing")}}}}}},setLandPrep:{_onEnter:function(){this.data.costs.seedbedPrep=this.data.hours.seedbedPrep=this.data.costs.landPrep=this.data.hours.landPrep=0;this.message="\ndo you plan to use 'CARABAO' (WATER BUFFALO) or 'TRACTOR'\nfor cropland preparation\n"},input:function(line){this.data.prepMethod=this.getResponse("CARABAO,TRACTOR",this.data.prepMethod,line);if(!this.errorFlag){if(this.data.prepMethod==="CARABAO"){this.transition("setCarabaoOwnership")}else{this.data.ownOrHire="HIRE";this.message="\nTHE CURRENT RATE FOR HIRED TRACTOR PLUS DRIVER IS\n"+this.TRACTOR_RATE+" PESOS/HOUR.\n";this.data.costs.seedbedPrep=this.CARABAO_RATE*this.SEEDBED_PREP_HOURS;this.data.costs.landPrep=this.TRACTOR_RATE*this.TRACTOR_HOURS;if(!(this.data.runCount>1)){this.transition("setWeeding")}else{this.transition("startProcessing")}}}}},setCarabaoOwnership:{_onEnter:function(){this.message="\ndo you 'OWN' or will you 'HIRE' the carabao\n"},input:function(line){this.data.ownOrHire=this.getResponse("OWN,HIRE",this.data.ownOrHire,line);if(!this.errorFlag){if(this.data.ownOrHire==="HIRE"){this.message="\nTHE CURRENT RATE FOR CARABAO PLUS HANDLER IS "+this.CARABAO_RATE+" PESOS/\nHOUR.\n";this.data.costs.seedbedPrep=this.CARABAO_RATE*this.SEEDBED_PREP_HOURS;this.data.costs.landPrep=this.CARABAO_RATE*this.CARABAO_HOURS}else{this.data.hours.seedbedPrep=this.SEEDBED_PREP_HOURS;this.data.costs.landPrep=2/6*(this.SEEDBED_PREP_HOURS+this.CARABAO_HOURS);this.data.hours.landPrep=this.CARABAO_HOURS}if(!(this.data.runCount>1)){this.transition("setWeeding")}else{this.transition("startProcessing")}}}},setWeeding:{_onEnter:function(){this.message+="\nThere are three weeding methods available\n     1. HAND WEEDING.\n     2. ROTARY HAND WEEDER.\n     3. GRANULAR HERBICIDE (2,4-D ISOPROPYL ESTER)\n\nTHESE METHODS MAY BE EMPLOYED EITHER SINGLY OR IN\nCOMBINATION WITH ONE OTHER METHOD. WHEN REQUESTED,\nENTER NUMBERS CORRESPONDING TO THE METHODS ABOVE,\nFOR INSTANCE '2' MEANS ONE ROTARY WEEDING, '32' MEANS\n2,4-D FOLLOWED BY A ROTARY WEEDING, AND '11' MEANS\n2 HAND WEEDINGS.\n"+this.waitText},input:function(line){this.transition("setWeeding2")}},setWeeding2:{_onEnter:function(){this.message="\nPlease note the following:\n   A. WEEDS COMPETE VIGOROUSLY WITH RICE AND LOWER\n      THE POTENTIAL YIELD.\n   B. WHEN A HAND WEEDING IS DONE IN COMBINATION WITH\n      ANOTHER METHOD, THE HAND WEEDING IS USUALLY DONE\n      LAST (I.E. '31', NOT '13'!)\n   C. if YOU DESIRE NO WEEDING, ENTER 0 (ZERO).\n\nWhat weeding method(s) do you wish to use\n"},input:function(line){this.data.weedingMethod=this.getResponse(this.VALID_WEEDING(),this.data.weedingMethod,line);if(!this.errorFlag){this.data.costs.weeding=this.WEEDING_EFFECTS[this.data.weedingMethod][2];this.data.hours.weeding=this.WEEDING_EFFECTS[this.data.weedingMethod][1];this.transition("setMolluscicide")}}},setMolluscicide:{_onEnter:function(){this.snailAttacks++;this.message="\nOh my goodness! DURING THE WEED SURVEY MANY BRIGHT RED EGG\nMASSES OF THE GOLDEN SNAIL WERE SEEN IN YOUR FIELDS. If you wish\nyou may spray MOLLUSCICIDE or remove the snails and eggs by\nhand. You may also choose to do nothing.\n\nDO YOU WISH TO SPRAY A MOLLUSCICIDE?\n"},input:function(line){var response;response=this.getYesNo(line);if(!this.errorFlag){if(response){this.data.snailAttacks=0;this.data.costs.molluscicide=315;this.data.hours.molluscicide=18;this.transition("setWeedingStart")}else{this.transition("setHandPickSnails")}}}},setHandPickSnails:{_onEnter:function(){this.snailAttacks++;this.message="\nDO YOU WISH TO HAND PICK YOUR FIELDS?\n"},input:function(line){var response;response=this.getYesNo(line);if(!this.errorFlag){if(response){this.snailAttacks=0;this.data.costs.molluscicide=0;this.data.hours.molluscicide=60}this.transition("setWeedingStart")}}},setWeedingStart:{_onEnter:function(){this.message="\nHOW MANY DAYS AFTER TRANSPLANTING IS THE WEEDING\nOPERATION STARTED\n"},input:function(line){this.weedingDaysStart=this.getNumber(this.weedingDaysStart,line);if(!(this.errorFlag||this.data.runCount>1)){this.transition("setThreshing")}if(this.data.runCount>1){this.transition("startProcessing")}}},setThreshing:{_onEnter:function(){this.message="\nIs the threshing to be done by 'HAND' or by 'MACHINE'\n"},input:function(line){this.data.threshingMethod=this.getResponse("HAND,MACHINE",this.data.threshingMethod,line);if(!(this.errorFlag||this.data.runCount>1)){this.transition("setMarketValue")}if(this.data.runCount>1){this.transition("startProcessing")}}},setMarketValue:{_onEnter:function(){this.message="\nWhat is the market value of ROUGH RICE (PESOS/KG.)\n"},input:function(line){this.data.price=this.getNumber(this.data.price,line);if(!this.errorFlag){if(this.data.price>6.35){this.message="\nTHAT'S WAY ABOVE THE LATEST REPORTED MARKET PRICE.\nPLEASE REPEAT THE PRICE PER KILOGRAM.\n"}else{this.transition("startProcessing")}}}},startProcessing:{_onEnter:function(){var r;this.data.riceYield=this.data.pesticideYieldFactor*this.data.seedDefectFactor*this.WEEDING_EFFECTS[this.data.weedingMethod][0]*((this.data.ureaFactor1()*Math.pow(this.data.fertNContent(),2))+(this.data.ureaFactor2()*this.data.fertNContent())+1)*this.data.seedYield();if(this.data.riceYield<0){this.data.riceYield=0}this.message="\n\n\nrandomizing events...\n    calculating costs and yields... DONE! \n\n";if(this.data.prepMethod==="TRACTOR"){this.data.riceYield*=1.07;this.message+="\nYOU DID A BEAUTIfUL JOB PREPARING THE FIELDS.\n"}if(this.data.weedingDaysStart>=20){this.message+="YOU WAITED TOO LONG TO START THE WEEDING. YOU HAVE \nWASTED YOUR TIME AND YOUR LABOR.  TOUGH LUCK!";this.data.riceYield*=0.7}else{if(this.data.weedingDaysStart>=14){this.message+="YOU HAVE WAITED SO LONG TO START THE WEEDING THAT IT IS\nONLY PARTLY SUCCESSFUL.  BETTER LUCK NEXT TIME.";this.data.riceYield*=0.85}}this.message+="\n";if(this.data.seedType==="IR64"){r=Math.floor(Math.random()*4)/100;this.message+="LOOKS AS if BACTERIAL BLIGHT AND BLAST HAVE CAUSED ABOUT\n"}else{r=Math.floor(Math.random()*13)/100;this.message+="UNFORTUNATELY, GRASSY STUNT AND TUNGRO HAVE CAUSED ABOUT\n"}this.message+=""+(100*r)+" PERCENT LOSS OF POTENTIAL YIELD.\n";this.data.riceYield*=1-r;this.message+="\nA VERY STRONG TYPHOON IS REPORTED HEADED TOWARD YOUR AREA\nFROM THE SOUTH-EAST. TIE DOWN YOUR HOUSE AND PRAY THAT THE\nSTORM MISSES YOUR FARM.\n\n\nWhat is YOUR prayer?"},input:function(line){this.transition("processing2")}},processing2:{_onEnter:function(){var r4;this.message="";if(this.data.snailAttacks>=1){this.message+="\nYou didn't get rid of the snails last year. Too bad - they have\ndestroyed MANY plants this year. Better try escargot with garlic.\n";r4=Math.floor(12+(Math.random()*6));this.data.riceYield*=1-0.01*r4}this.message+="\nTHE FARM SPECIALIST ESTIMATES YOUR CROP AS IT NOW STANDS\nAT "+(Math.round(10*this.data.riceYield/50)/10)+" CAVANS PER HECTARE.\n\nDo you think that SHE is correct?"},input:function(line){this.transition("processing3")}},processing3:{_onEnter:function(){this.message="\nW E L L   DON'T COUNT ON THAT FOR HARVEST!!!!\n";if(!this.data.skipIntro){this.message+="\nBrown plant hopper IS A VERY COMMON INSECT PEST. LOSS OF CROP\nMAY BE ANYWHERE FROM 0% TO 15% if INSECTICIDE IS USED\nAS SOON AS INFESTATION IS DISCOVERED (DEPENDING UPON DEGREE\nOF INFESTATION). However, if CONTROLS ARE NOT USED, LOSSES\nMAY RUN AS HIGH AS 30%. ON A SLIDING SCALE FROM 0 TO 10:\n\n0 (NONE)...............5 (AVERAGE)..............10 (SEVERE)\n"}this.message+="\n";this.insectAttack=0;if(!this.data.costs.earlyPestControl){this.message+="DESPITE THE EARLY PEST CONTROL PROGRAM YOU HAVE SOME SIGNS OF\nINSECT ATTACK. (BUT MUCH LESS THAN YOUR NEIGHBOR TO THE\nEAST). YOU CAN FIGHT THE ATTACK WITH A SPRAYED INSECTICIDE.\n";this.insectAttack=Math.floor(Math.random()*5)+1;if(this.data.seedType==="IR64"){this.insectAttack/=2}else{if(this.insectAttack<=0){this.message+="YOUR EARLY PEST CONTROL PROGRAM WAS SO EFFECTIVE THAT"}}}else{this.insectAttack=Math.floor(Math.random()*10)+1;if(this.data.seedType==="IR64"){this.insectAttack/=2}}this.message+="THE DEGREE OF INSECT ATTACK THIS YEAR IS "+this.insectAttack+"\n\nDO YOU WISH TO SPRAY AN INSECTICIDE?"},input:function(line){var response;response=this.getYesNo(line);if(!this.errorFlag){if(response){this.data.costs.insecticide=1.5*112;this.data.hours.insecticide=2*8}else{this.data.costs.insecticide=0;this.data.hours.insecticide=0;this.insectAttack*=2}this.data.riceYield*=1-0.015*this.insectAttack;this.transition("processing4")}}},processing4:{_onEnter:function(){this.message="";if(!this.data.skipIntro){this.message+="\nBEING A GOOD ECOLOGY MINDED FARMER YOU DID NOT KILL OR \nPOISON THE BIRDS. THEY ARE NOW EATING THE RIPENING GRAIN."}this.message+="\nDO YOU WISH TO PROTECT YOUR CROP AGAINST BIRDS?"},input:function(line){var r3,response;response=this.getYesNo(line);if(!this.errorFlag){r3=(Math.random()*6)+1;this.message="";if(response){if(this.data.runCount<=4){this.message+="\nYOU AND YOUR SONS WILL TAKE TURNS STANDING IN THE FIELDS\nWAVING FLAGS AND USING SLINGSHOTS ON THE LITTLE PESTS."}this.data.hours.birdRepelling=14*4;r3=Math.floor(r3/2+0.5);this.message+="\nYOUR BIRD LOSS HAS BEEN REDUCED TO ONLY "+r3+" PERCENT!\n"}else{this.data.hours.birdRepelling=0;this.message+="\nOH WELL, THEY WILL GET ONLY ABOUT "+r3+" PERCENT.\n"}this.data.riceYield*=1-0.015*r3;this.transition("processing5")}}},processing5:{_onEnter:function(){this.data.typhoonLevel=Math.floor(Math.random()*10);if(this.data.typhoonLevel<=4){this.message="\nYour prayer has worked. The typhoon missed your area!\n"}else{this.message="\nSECOND TYPHOON WARNING. IT'S COMING YOUR WAY.\n"}this.message+="\nRATS ARE ATTACKING RICE IN SOME FIELDS TO THE SOUTH OF YOUR\nFARM - DO YOU WISH TO SET OUT POISON?"},input:function(line){var response;response=this.getYesNo(line);if(!this.errorFlag){this.data.ratDamage=Math.abs(Math.sqrt(-2*Math.log(Math.random()))*Math.sin(2*Math.PI*Math.random()));this.message="";if(response){this.transition("raticides")}else{this.data.costs.rodenticide=0;this.data.hours.rodenticide=0;this.transition("processing6")}}}},raticides:{_onEnter:function(){this.message="";if(!this.data.skipIntro){this.message+="\nACUTE RATICIDES GIVE SPECTACULAR RESULTS BUT IN THE LONG\nRUN CHRONIC POISONS ARE MORE EFFECTIVE AS WELL AS MORE\nCOSTLY AND TIME CONSUMING,"}this.message+="\nDO YOU WISH TO USE 'CHRONIC' OR 'ACUTE' POISON?"},input:function(line){this.data.poison=this.getResponse("CHRONIC,ACUTE",this.data.poison,line);if(!this.errorFlag){if(this.data.poison==="CHRONIC"){if(!this.data.skipIntro){this.message="\nYOU HAVE CHOSEN WARFARIN IN .5% CONCENTRATION. YOU MUST\nMIX IT WITH 19 PARTS OF CEREAL, WRAP IT IN BANANA LEAVES\nAND PLACE IT ALONG RAT RUNS.  DO THIS EACH DAY FOR 2 WEEKS."}this.data.costs.rodenticide=67.5;this.data.hours.rodenticide=14*3}else{if(!this.data.skipIntro){this.message="\nYOU WILL USE ZINC PHOSPHIDE. MIX IT WITH 150 PARTS OF \nBAIT AND PLACE IT ON RAT RUNS. BE CAREFUL - ONCE THIS REACHES\nTHE STOMACH (RAT OR HUMAN) IT RELEASES PHOSPHINE GAS\nCAUSING TOTAL PARALYSIS OF THE CENTRAL NERVOUS SYSTEM. IT\nIS VERY DANGEROUS. SOMEONE MAY GET HURT. RATS POISONED THIS\nWAY ARE RENDERED INEDIBLE!"}this.data.costs.rodenticide=48;this.data.hours.rodenticide=3*3}this.transition("processing6")}}},processing6:{_onEnter:function(){if(this.data.costs.rodenticide>0){this.data.ratDamage=Math.floor(this.data.ratDamage*5);this.message="\nYOU HAVE CUT YOUR POTENTIAL RAT LOSS DRAMATICALLY.\nCONGRATULATIONS! ONLY "+this.data.ratDamage+" PERCENT OF THE CROP WAS LOST.\n"}else{this.data.ratDamage=Math.floor(this.data.ratDamage*15);if(this.data.ratDamage>24){this.message="\nTHE PALAY WAS DOING WELL - BUT, MAN - DID YOU GET HIT BY\nRATS!! 10 DAYS BEFORE HARVEST THEY DESCENDED LIKE THE PLAGUE\nAND RUINED "+this.data.ratDamage+" PERCENT OF YOUR STAND.  EGAD!!\n"}else{if(this.data.ratDamage>12){this.message="\nCROP LOOKED GOOD BUT IN THE WEEK BEFORE HARVEST MANY RATS\nCONVERGED ON THE FIELDS AND DESTROYED "+this.data.ratDamage+" PERCENT OF\nTHE STANDING CROP.  BETTER LUCK NEXT YEAR!!\n"}else{this.message="\nYOU WERE VERY LUCKY THIS SEASON, PALAY GREW WELL AND YOU\nLOST ONLY "+this.data.ratDamage+" PERCENT OF THE CROP TO RATS.\n"}}}this.data.riceYield*=1-0.01*this.data.ratDamage;if(this.data.typhoonLevel>8){this.message+="\nTOUGH LUCK. THE TYPHOON PASSED THROUGH YOUR PROVINCE AND\nTHE CROP IS IN A TERRIBLE MESS.\n";this.data.riceYield*=0.65}else{if(this.data.typhoonLevel>4){this.message+="\nTHE TYPHOON PASSED CLOSE BY. HIGH WIND AND HEAVY RAIN CAUSED\nGREAT LODGING BUT MUCH OF THE CROP CAN BE SAVED.\n";this.data.riceYield*=0.8}}if(this.data.wages<90){this.message+="\nYour wages are so low that it is almost impossible to hire\nanyone. Work has been delayed and yield has suffered!\n";this.data.riceYield*=0.75}else{if(this.data.wages<=100){this.message+="\nYour wages are so low that it is almost impossible to hire\nanyone. Work has been delayed and yield has suffered!\n";this.data.riceYield*=0.88}}this.calculateFinalDetails();this.message+="\nWOULD YOU LIKE A COMPLETE COST-YIELD ANALYSIS?"},input:function(line){this.costYield=this.getYesNo(line);if(!this.errorFlag){this.transition("header")}}},header:{_onEnter:function(){return this.message="\n\n\n----------------------------------------------------------------\n\n\n\n       ECONOMICS OF RICE PRODUCTION IN THE PHILIPPINES\n\n\n\nRICE TYPE: "+this.data.seedType+"\n\nFARM SIZE: "+this.data.farmSize+" HECTARES\nTOTAL YIELD: "+(Math.round(this.totalYield))+" KILOGRAMS\n\n              ("+(Math.round(10*this.totalYield/50)/10)+" CAVANS PER HA.)\n\n\n.........................\n"+this.waitText},input:function(line){if(this.costYield){this.transition("costYield")}else{this.transition("summary")}}},costYield:{_onEnter:function(){this.message="\n                                        Land Reform Owner\nOPERATING COST:\n\nMATERIAL INPUTS\n";if(this.totalCosts("earlyPestControl")>0){this.message+=sprintf(this.FMT2," MATERIALS - EARLY PEST CONTROL",this.totalCosts("earlyPestControl"))+"\n"}this.message+=sprintf(this.FMT2," SEEDS(50 KG/HA)",this.totalCosts("seeds"))+"\n";if(this.totalCosts("fertilizer")>0){this.message+="    FERTILIZER (UREA) @"+this.data.fertCost+" PESOS/KG.\n"+(sprintf(this.FMT2,"  ",this.totalCosts("fertilizer")))+"\n"}if(this.totalCosts("insecticide")>0){this.message+=sprintf(this.FMT2,"INSECTICIDE @112 PESOS/BOTTLE",this.totalCosts("insecticide"))+"\n"}if(this.totalCosts("weeding")>0){this.message+=sprintf(this.FMT2,"HERBICIDE (.8KG AI/HA)",this.totalCosts("weeding"))+"\n"}if(this.totalCosts("rodenticide")>0){this.message+=sprintf(this.FMT2,"RODENTICIDE AND BAIT",this.totalCosts("rodenticide"))+"\n"}if(this.totalCosts("molluscicide")>0){this.message+=sprintf(this.FMT2,"MOLLUSCICIDE",this.totalCosts("molluscicide"))+"\n"}return this.message+="\n"+this.waitText},input:function(line){this.transition("costYield2")}},costYield2:{_onEnter:function(){this.message="\nSEEDBED PREPARATION -- 4 DAYS WORKER AND\n";if(this.data.ownOrHire==="HIRE"){this.message+="    CARABAO AT "+(6*this.CARABAO_RATE)+" PESOS PER DAY\n"+(sprintf(this.FMT2,"  ",this.totalCosts("seedbedPrep")))}else{this.message+="    CARABAO. SEE 'LAND PREPARATION' FOR\n    COST OF OWNING ANIMAL\n"+(sprintf(this.FMT2,"OPERATOR'S LABOR",this.labor("seedbedPrep")))}return this.message+="\n"+this.waitText},input:function(line){this.transition("costYield3")}},costYield3:{_onEnter:function(){this.message="\nLAND PREPARATION -- PLOWING AND HARROWING\n";if(this.data.prepMethod==="TRACTOR"){this.message+="    "+(this.data.farmSize*this.TRACTOR_HOURS/8)+" TRACTOR DAYS @"+(8*this.TRACTOR_RATE)+" PESOS/DAY\n"+(sprintf(this.FMT2,"  ",this.totalCosts("landPrep")))}else{if(this.data.ownOrHire==="HIRE"){this.message+="   "+(this.data.farmSize*this.CARABAO_HOURS/6)+" DAYS FOR CARABAO\n    AT "+(6*this.CARABAO_RATE)+" PESOS PER DAY\n"+(sprintf(this.FMT2,"  ",this.totalCosts("landPrep")))}else{this.message+=""+(sprintf(this.FMT2,"COST OF OWNING CARABAO",this.totalCosts("landPrep")))+"\n"+(sprintf(this.FMT2,"OPERATORS LABOR",this.labor("landPrep")))}}return this.message+="\n"+this.waitText},input:function(line){this.transition("costYield4")}},costYield4:{_onEnter:function(){this.message="\n";if(this.labor("earlyPestControl")>0){this.message+=""+(sprintf(this.FMT2,"LABOR - EARLY PEST CONTROL",this.labor("earlyPestControl")))+"\n"}if(this.labor("molluscicide")>0){this.message+=sprintf(this.FMT,"LABOR FOR SNAIL REMOVAL",this.labor("molluscicide"))+"\n"}if(this.totalCosts("fertilizer")>0){this.message+="COSTS OF APPLYING FERTILIZER\n    "+(this.data.farmSize*this.data.hours.fertilizer/8)+" PERSON DAYS @"+this.data.wages+" PESOS/DAY\n"+(sprintf(this.FMT2,"  ",this.labor("fertilizer")))}return this.message+="\n"+(sprintf(this.FMT,"TRANSPLANTING - 18 WORK DAYS/HA",this.labor("transplanting")))+"\n"+this.waitText},input:function(line){this.transition("costYield5")}},costYield5:{_onEnter:function(){this.message="\n";if(this.labor("insecticide")>0){this.message+="\n APPLICATION OF PESTICIDE\n     2 DAYS PER HA. AT "+this.data.wages+" PESOS PER DAY\n "+(sprintf(this.FMT2,"  ",this.labor("insecticide")))+"\n"}if(this.data.weedingMethod!=="0"){this.message+="WEEDING COSTS -- METHOD "+this.data.weedingMethod+"\n    "+this.data.hours.weeding+" HOURS PER HECTARE\n"+(sprintf(this.FMT2,"  ",this.labor("weeding")))+"\n"}if(this.labor("birdRepelling")>0){this.message+=sprintf(this.FMT,"CHILD LABOR FOR BIRD WATCH",this.labor("birdRepelling")/2)+"\n"}if(this.labor("rodenticide")>0){this.message+=sprintf(this.FMT,"APPLICATION OF RODENTICIDE",this.labor("rodenticide"))+"\n"}return this.message+=""+this.waitText},input:function(line){this.transition("costYield6")}},costYield6:{_onEnter:function(){this.message="\nHARVESTING COSTS\n"+(sprintf(this.FMT2,"HARVEST RATE - 32 KG/WORK HR",this.labor("harvesting")))+"\n\nTHRESHING\n";if(this.data.threshingMethod==="HAND"){this.message+=sprintf(this.FMT2,"RATE ABOUT 40 KG/HR",this.labor("threshing")/2)+"\n"}else{this.message+=sprintf(this.FMT2,"COST BY MACHINE - 5% OF YIELD",this.totalCosts("threshing"))+"\n"}return this.message+="\n"+(sprintf(this.FMT,"HAULING COST - .012 PESOS/KG",this.totalCosts("hauling")))+"\n"+this.waitText},input:function(line){this.transition("costYield7")}},costYield7:{_onEnter:function(){return this.message="\n                                     ---------------------\n"+(sprintf(this.FMT2,"   TOTAL OPERATING COSTS",this.operatingCosts))+"\n\nNOTE, HOWEVER, THAT A CONSIDERABLE PORTION OF THE FARMER'S\nCOSTS ARE IN TERMS OF personal AND family LABOR.\n\n\n.........................\n"+this.waitText},input:function(line){this.transition("costYield8")}},costYield8:{_onEnter:function(){return this.message="\n\nFIXED COSTS\n"+(sprintf(this.FMT2,"IRRIGATION FEES - 945 PESOS/HA",this.totalCosts("irrigation")))+"\n"+(sprintf(this.FMT2,"LAND TAX - 1050 PESOS/HA",this.totalCosts("landTax")))+"\n"+(sprintf(this.FMT2,"PAY MORTGAGE - 4% OVER 20 YEARS",this.mortgage))+"\n                                     ---------------------\n\n"+(sprintf(this.FMT,"T O T A L  C O S T S",this.operatingCosts+this.totalCosts("irrigation")+this.totalCosts("landTax")+this.mortgage))+"\n\n. . . . . . . . . . . . . . . . . . . .\n\n"+this.waitText},input:function(line){this.transition("summary")}},summary:{_onEnter:function(){var profit,totalOperatingCosts;console.log(this);totalOperatingCosts=this.operatingCosts+this.totalCosts("irrigation")+this.totalCosts("landTax")+this.mortgage;profit=(this.totalYield*this.data.price)-totalOperatingCosts;profit=Math.round(profit*100)/100;this.message="\nS U M M A R Y\n                                        LAND REFORM OWNER\n  TOTAL VALUE OF "+(Math.round(this.totalYield*100)/100)+" KILOGRAMS\n  OF PALAY AT "+this.data.price+"\n  PESOS PER KILOGRAM                        "+(Math.round(this.totalYield*this.data.price*100)/100)+"\n\n  LESS TOTAL EXPENSES                       "+(Math.round(totalOperatingCosts*100)/100)+"\n                                     --------------------\n\n N E T  P R O F I T                         "+profit+"\n\n   Feels good to own your own land - DOESN'T IT???\n\n";if(profit<this.data.farmSize*2800){this.message+="YOU ARE ONE HECK OF A POOR FARMER - YOUR KIDS WILL STARVE\nAT THAT RATE.  YOU MADE AT LEAST ONE terrible DECISION.\nYOU HAD BETTER CORRECT IT BEFORE NEXT SEASON.\n"}else{if(profit<this.data.farmSize*4500){this.message+="THAT IS NOT A GOOD YEAR AT ALL. BETTER IMPROVE YOUR TECHNIQUE\nOR YOU WILL LOSE THE LAND YOU WORKED SO HARD TO EARN\n"}}return this.message+="----------------------------------------------------------------\n"+this.waitText},input:function(line){this.transition("runAgain")}},runAgain:{_onEnter:function(){this.message="\n\n";if(!this.data.skipIntro){this.message+="YOU WILL NOW HAVE THE OPTION OF RERUNNING THE PROGRAM.\nYOU MAY KEEP THE SAME RICE TYPE OR YOU MAY CHANGE.\nIN EITHER CASE THE INPUTS WILL REMAIN AS FOR THE FIRST\nCROP UNTIL YOU DECIDE TO ADOPT A DifFERENT TECHNOLOGY."}return this.message+="\n\nDO YOU WISH TO RUN THE PROGRAM AGAIN?\n\n"},input:function(line){var response;response=this.getYesNo(line);if(!this.errorFlag){if(response){this.transition("changeFactors")}else{this.transition("goodbye")}}}},changeFactors:{_onEnter:function(){this.data.runCount++;return this.message="WHICH FACTOR DO YOU WISH TO CHANGE\n\nENTER '0' (ZERO) if YOU DESIRE NOT TO CHANGE ANYTHING.\nOTHERWISE ENTER a number from the list below.\n1   'SIZE OF FARM'\n2   'COST OF OUTSIDE LABOR'\n3   'TYPE OF RICE (SEED) USED'\n4   'COST OF SEED'\n5   'USE OF SYSTEMIC PESTICIDE, I.P.M., OR NOTHING' \n6   'COST AND AMOUNT OF NITROGEN FERTILIZER'\n7   'METHOD OF CROPLAND PREPARATION' \n8   'METHOD OF WEEDING AND SNAIL PROTECTION'\n9   'METHOD OF THRESHING' \n10   'MARKET VALUE OF ROUGH RICE'\n\nRemember, in a controlled experiment you can change only\nONE factor at a time! WHICH ONE???"},input:function(line){this.rerunFactor=this.getResponse([1,2,3,4,5,6,7,8,9,10].join(","),this.rerunFactor,line);if(!this.errorFlag){switch(this.rerunFactor){case"0":this.transition("startProcessing");break;case"1":this.transition("setFarmSize");break;case"2":this.transition("setWages");break;case"3":this.transition("setSeedType");break;case"4":this.transition("setSeedCost");break;case"5":this.transition("setPesticide");break;case"6":this.transition("setFertilizer");break;case"7":this.transition("setLandPrep");break;case"8":this.transition("setWeeding");break;case"9":this.transition("setThreshing");break;case"10":this.transition("setMarketValue")}}}},goodbye:{_onEnter:function(){return this.message="\n\n\nTHANKS FOR PLAYING RICEGROW!\n\n\n"},input:function(line){}}},waitText:"\nPress Enter to continue...\n",getYesNo:function(line){var response;this.errorFlag=false;response=line.trim().toUpperCase();if(response==="YES"||response==="Y"||response==="NO"||response==="N"){return response==="YES"||response==="Y"}else{this.errorFlag=true;this.message="Please enter 'YES' or 'NO'"}},getNumber:function(original,line){var response;this.sameFlag=false;this.errorFlag=false;response=line.trim().toUpperCase();if(response==="SAME"){if(original!==null){this.sameFlag=true;return original}else{this.message="You cannot use the same value";this.errorFlag=true}}else{if(!isNaN(parseFloat(response))){return parseFloat(response)}else{this.message="Please type a number";this.errorFlag=true}}},getResponse:function(valid,original,line){var response;this.sameFlag=false;this.errorFlag=false;response=line.trim().toUpperCase();if(response==="SAME"){if(original!==null){this.sameFlag=true;return original}else{this.message="You cannot use the same value";this.errorFlag=true}}else{if(_.contains(valid.split(","),response)){return response}else{this.message="That is not a legal response. Please retype.";this.errorFlag=true}}},calculateFinalDetails:function(){var subtotal;this.data.hours.harvesting=0.0311*this.data.riceYield;this.data.costs.threshing=this.data.hours.threshing=0;if(this.data.threshingMethod==="MACHINE"){this.data.riceYield*=0.97;this.data.costs.threshing=0.05*this.data.riceYield*this.data.price}else{this.data.hours.threshing=0.05*this.data.riceYield}this.data.costs.hauling=0.012*this.data.riceYield;subtotal=this.totalCosts("earlyPestControl");subtotal+=this.totalCosts("seeds");subtotal+=this.totalCosts("fertilizer");subtotal+=this.totalCosts("insecticide");subtotal+=this.totalCosts("weeding");subtotal+=this.totalCosts("rodenticide");subtotal+=this.totalCosts("molluscicide");subtotal+=this.totalCosts("seedbedPrep")+this.labor("seedbedPrep");subtotal+=this.totalCosts("landPrep")+this.labor("landPrep");subtotal+=this.labor("earlyPestControl");subtotal+=this.labor("fertilizer");subtotal+=this.labor("transplanting");subtotal+=this.labor("insecticide");subtotal+=this.labor("weeding");subtotal+=this.labor("molluscicide");subtotal+=this.labor("birdRepelling")/2;subtotal+=this.labor("rodenticide");subtotal+=this.labor("harvesting");subtotal+=this.totalCosts("threshing");subtotal+=this.labor("threshing");subtotal+=this.totalCosts("hauling");this.operatingCosts=subtotal;this.totalYield=this.data.riceYield*this.data.farmSize;return this.mortgage=(this.totalYield*this.data.price)*4*0.07}});console1=$("#console1");controller1=console1.console({promptLabel:"> ",commandHandle:function(line){gameFsm.handle("input",line);return gameFsm.message},autofocus:true,animateScroll:true,welcomeMessage:"    ARE YOU FAMILIAR ENOUGH WITH THE PROGRAM TO WISH TO SKIP\n    ALL PRELIMINARIES?  "})})})(jQuery,_)}).call(this);